show_number_selected_row=function(){var t=$("input.tbl-item-checkbox:checked").length,e=$("input.tbl-item-checkbox").length,a=0;for(i=0;i<t;i++)a+=parseInt($($("input.tbl-item-checkbox:checked")[i]).parent().parent().find(".tbl_price_purchase").text());a*=1e3,$.notify("Đã chọn: "+t+" / "+e+". tổng tiền = "+a.toLocaleString(),{position:"top left",className:"success",showDuration:200,autoHideDelay:3e3})},unselect_not_checked=function(){$("input.tbl-item-checkbox").each(function(){$(void 0).is(":checked")||$(void 0).parent().parent().removeClass("checked")})},unselect_checked=function(){$("input.tbl-item-checkbox").each(function(){$(void 0).is(":checked")&&$(void 0).parent().parent().removeClass("checked")})},uncheck_checked=function(){$("input.tbl-item-checkbox").each(function(){$(void 0).is(":checked")&&$(void 0).prop("checked",!1)})},uncheck_not_checked=function(){$("input.tbl-item-checkbox").each(function(){$(void 0).is(":checked")||$(void 0).prop("checked",!1)})},right_context_menu_display=function(t,e,a,n,i){$(".load-new-contact-id").attr("data-contact-id",e),$("a.send_to_mobile").attr("contact_name",a).attr("contact_phone",i);var c=$("input.tbl-item-checkbox:checked").length;c>1?($("a.view_duplicate, .action_view_detail_contact, .divide_one_contact_achor, .edit-one-contact, .transfer_one_contact, .send_to_mobile").addClass("hidden"),$(".divide_multi_contact,.transfer_contact, .select_provider, .btn-export-excel, .btn-export-excel-for-viettel, NaN").removeClass("hidden")):($(".action_view_detail_contact, .divide_one_contact_achor, a.view_duplicate, .edit-one-contact, .transfer_one_contact, .send_to_mobile").removeClass("hidden"),$(".divide_multi_contact, .transfer_contact, .select_provider, .export_to_string, .send-banking-info-multi-course").addClass("hidden"),n>0?$("a.view_duplicate").removeClass("hidden"):$("a.view_duplicate").addClass("hidden")),"manager"===t?($(".divide_one_contact_achor").attr("contact_id",e),$(".divide_one_contact_achor").attr("contact_name",a),c<1&&(n>0?$(".divide_one_contact_achor").addClass("hidden"):$(".divide_one_contact_achor").removeClass("hidden"))):"sale"!==t&&"cod"!==t||($(".transfer_one_contact").attr("contact_id",e),$(".transfer_one_contact").attr("contact_name",a))};var _SO_MAY_SAI_=1,_KHONG_NGHE_MAY_=2,_NHAM_MAY_=3,_DA_LIEN_LAC_DUOC_=4,_CONTACT_CHET_=5,_CHUA_CHAM_SOC_=0,_TU_CHOI_MUA_=3,_DONG_Y_MUA_=4;check_edit_contact=function(){var t=$("select[name='call_status_id']").val(),e=$("select[name='ordering_status_id']").val(),a=$(".date_recall").val(),n=$("select.select_course_code").val(),i=$('[name="price_purchase"]').val();if(0==$("select.edit_payment_method_rgt").val())return $.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Bạn cần cập nhật hình thức thanh toán!"}),!1;if(0==t)return $.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Bạn cần cập nhật trạng thái gọi!"}),!1;if(0==check_rule_call_stt(t,e))return $.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Trạng thái gọi và trạng thái đơn hàng không logic! Bạn cần cập nhật chính xác để dữ liệu của chúng ta được sạch sẽ!"}),!1;if(""!=a){if(now_greater_than_input_date(a))return $.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Ngày gọi lại không thể là một ngày trước ngày hôm nay!"}),!1;if(check_rule_call_stt_and_date_recall(t,e,a))return $.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Nếu contact không liên lạc được hoặc không thể chăm sóc được nữa thì không thể có ngày gọi lại lớn hơn ngày hiện tại!"}),!1}return"0"==n?($.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn mã khóa học!"}),!1):""!=i||($.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn giá tiền mua!"}),!1)},check_rule_call_stt=function(t,e){return(t!=_SO_MAY_SAI_&&t!=_KHONG_NGHE_MAY_&&t!=_NHAM_MAY_||e==_CHUA_CHAM_SOC_)&&(t!=_DA_LIEN_LAC_DUOC_||e!=_CHUA_CHAM_SOC_)},check_rule_call_stt_and_date_recall=function(t,e,a){return!(!stop_care(t,e)||!now_greater_than_input_date(a))},stop_care=function(t,e){return t==_SO_MAY_SAI_||t==_NHAM_MAY_||t==_KHONG_NGHE_MAY_||e==_DONG_Y_MUA_||e==_TU_CHOI_MUA_||e==_CONTACT_CHET_},now_greater_than_input_date=function(t){var e=t.split(/-/),a=e[2],n=e[1],i=e[0],c=new Date;c=c.getTime();var o=new Date(a,n-1,i);return o=o.getTime(),c>o},setEqualTableHeight=function(){$(".table-view-1").height()>$(".table-view-2").height()?$(".table-view-2").height($(".table-view-1").height()):$(".table-view-1").height($(".table-view-2").height()),$(".table-edit-1").height()>$(".table-edit-2").height()?$(".table-edit-2").height($(".table-edit-1").height()):$(".table-view-1").height($(".table-view-2").height()),$(".table-1").height()>$(".table-2").height()?$(".table-2").height($(".table-1").height()):$(".table-1").height($(".table-2").height()),$(".table-add-1").height()>$(".table-add-2").height()?$(".table-add-2").height($(".table-add-1").height()):$(".table-add-1").height($(".table-add-2").height())},$.fn.setFixTable=function(t){var e=$($(this).children()[0]).clone();$(this).prepend(e);var a=$(this).children()[0],n=$(this).children()[1];$(n).addClass("table-head-pos"),$(a).addClass("fixed-table").css("display","none");var i=1;$(".table-head-pos>tr>th").each(function(){$(this).attr("id","th_fix_id_"+i++)}),i=1,$(".fixed-table>tr>th").each(function(){$(this).attr("id","f_th_fix_id_"+i++)}),$(document).on("scroll",function(){$("html").scrollTop()>$(".table-head-pos").offset().top?($(".fixed-table").css({display:"block"}),$('[id^="th_"]').each(function(){var t=$(this).attr("id"),e=$(this).width(),a=$(this).height();$("#f_"+t).width(e),$("#f_"+t).height(a)})):$(".fixed-table").css({display:"none"})})},Array.prototype.unique=function(){return this.filter(function(t,e,a){return e==a.indexOf(t)})},$(".action-contact-admin").confirm({theme:"supervan",title:"Bạn có chắc chắn với hành động này?",content:"",buttons:{confirm:{text:"Có",action:function(){var t=this.$target,e=t.attr("data-contact-id"),a=$("#base_url").val()+t.attr("data-url");$.ajax({type:"POST",url:a,data:{contact_id:e},success:function(e){"1"===e?$.alert({theme:"modern",title:t.attr("data-answer"),content:"",buttons:{confirm:{text:"OK",action:function(){location.reload()}}}}):alert(e)},error:function(t){return alert(t)}})}},cancel:{text:"Nope",action:function(){}}}}),$(document).on("click",".create-adset-from-fb",function(t){t.preventDefault(),$(".add-name-from-fb").val($(this).attr("adset-name")),$(".add-adset-id-from-fb").val($(this).attr("id-fb")),$campaignOption=' <select class="form-control selectpicker" name="add_campaign_id" tabindex="-98"> <option value="'+$(this).attr("campaign-crm-id")+'" selected="selected"> '+$(this).attr("campaign-name-facebook")+"</option></select>",$(".select-campign-fetch").append($campaignOption),$(".add_item_from_fb_modal").modal("show")}),$(document).on("click","a.add-item-fetch",function(t){t.preventDefault();var e=$("#url-add-item-fetch").val();$.ajax({url:e,type:"POST",beforeSend:function(){return $(".popup-wrapper").show()},success:function(t){$("div.replace_content_add_item_fetch_modal").html(t)},complete:function(){$(".add_item_modal_fetch").modal("show"),$(".popup-wrapper").hide()}})}),$(document).on("click",".create-campaign-from-fb",function(t){t.preventDefault(),$(".add-name-from-fb").val($(this).attr("campaign-name")),$(".add-campaign-id-from-fb").val($(this).attr("id-fb")),$(".add_item_from_fb_modal").modal("show")}),$(document).on("click","a.add_item",function(t){t.preventDefault();var e=$("#url_add_item").val();$.ajax({url:e,type:"POST",success:function(t){$("div.replace_content_add_item_modal").html(t)},complete:function(){$(".add_item_modal").modal("show")}})}),$("a.delete_multi_item").confirm({theme:"supervan",title:"Bạn có chắc chắn muốn xóa các dòng đã chọn không?",content:"Hãy nhớ thứ tự xóa là xóa ad => xóa adset => xóa campaign.",buttons:{confirm:{text:"Xóa",action:function(){0==$("input.tbl-item-checkbox:checked").length?$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn dòng cần xóa!"}):($("#form_item").attr("action",$("#url_delete_multi_item").val()).attr("method","POST"),$("#form_item").submit())}},cancel:{text:"Nope",action:function(){}},somethingElse:{text:"Khác",btnClass:"btn-blue",keys:["enter","shift"],action:function(){}}}}),$("a.delete_item").confirm({theme:"supervan",title:"Bạn có chắc chắn muốn xóa dòng này không?",content:"Hãy nhớ thứ tự xóa là xóa ad => xóa adset => xóa campaign.",buttons:{confirm:{text:"Xóa",action:function(){var t=this.$target.attr("item_id");$.ajax({type:"POST",url:$("#url_delete_item").val(),data:{item_id:t},success:function(t){"1"===t?location.reload():alert(t)},error:function(t){alert("Không thể xóa do foreign-key, liên hệ admin để biết thêm chi tiết")}})}},cancel:{text:"Nope",action:function(){}},somethingElse:{text:"Khác",btnClass:"btn-blue",keys:["enter","shift"],action:function(){}}}}),$(document).on("click","a.edit_item",function(t){t.preventDefault();var e=$(this).attr("item_id"),a=$("#url_edit_item").val();$.ajax({url:a,type:"POST",data:{item_id:e},success:function(t){$("div.replace_content_edit_item_modal").html(t)},complete:function(){$(".edit_item_modal").modal("show")}})}),$('th[class^="order_new_"]').on("click",function(){var t=$(this).attr("class");t=(t=t.split(/ /))[0],$('input[class^="order_new_"]').not("input."+t).attr("value","0"),"0"!==$("input."+t).val()?"ASC"!==$("input."+t).val()?"DESC"!==$("input."+t).val()||$("input."+t).val("0").promise().done(function(){$("#form_item").submit()}):$("input."+t).val("DESC").promise().done(function(){$("#form_item").submit()}):$("input."+t).attr("value","ASC").promise().done(function(){$("#form_item").submit()})}),$(".real_filter").on("change",function(){$("#form_item").submit()}),$(function(){$(".table-fixed-head").setFixTable()}),$(document).on("change",'.toggle-input [name="edit_active"]',function(){var t=$(this).prop("checked")?"1":"0",e=$(this).attr("item_id");$.ajax({type:"POST",url:$("#url_edit_active").val(),data:{active:t,item_id:e},success:function(t){"1"==t?$.notify("Lưu thành công",{position:"top left",className:"success",showDuration:200,autoHideDelay:2e3}):alert("Có lỗi xảy ra! Vui lòng liên hệ admin.")},error:function(t){alert(t)}})}),$(function(){$.each($(".tbl_pricepC3"),function(){parseInt($(this).text().replace(".",""))>5e4&&$(this).addClass("bg-red")})}),$(document).on("click","a.delete_bill",function(t){if(1==confirm("Bạn có chắc chắn muốn xóa dòng đối soát này không?")){var e=$(this),a=$(this).attr("bill_id");t.preventDefault(),$.ajax({type:"POST",url:$("#base_url").val()+"CODS/check_L8/delete_bill",data:{bill_id:a},success:function(t){"1"===t?e.parent().parent().parent().hide():alert(t)},error:function(t){return alert(t)}})}}),$(document).on("click","a.edit_bill",function(t){t.preventDefault();var e=$(this).attr("bill_id"),a=$("#base_url").val()+"CODS/check_L8/show_edit_bill";$.ajax({url:a,type:"POST",data:{bill_id:e},success:function(t){$("div.replace_content_edit_bill_modal").html(t)},complete:function(){return $(".edit_bill_modal").modal("show")}})}),$(".btn-export-excel").on("click",function(t){t.preventDefault(),$("#action_contact").attr("action",$("#base_url").val()+"cod/export_for_print"),$("#action_contact").submit()}),$(".btn-export-excel-for-viettel").on("click",function(t){t.preventDefault(),$("#action_contact").attr("action",$("#base_url").val()+"cod/export_for_send_provider"),$("#action_contact").submit()}),$(".export_to_string").on("click",function(t){t.preventDefault();var e="export-to-string-modal";$.ajax({url:$("#base_url").val()+"cod/export_to_string",type:"POST",data:$("#action_contact").serialize(),success:function(t){$("."+e).remove();$(".modal-append-to").append('<div class="export-to-string-modal"></div>'),$("."+e).html(t)},complete:function(){return $("."+e+" .modal").modal("show")}})}),$(".btn-reset-provider").on("click",function(t){t.preventDefault(),$("#action_contact").removeClass("form-inline"),$(".reset_provider_modal").modal("show")}),$(".btn-reset-provider").on("show.bs.modal",".modal",function(){$("#action_contact").addClass("form-inline")}),$(document).on("click",".select_provider",function(t){$("#action_contact").removeClass("form-inline"),t.preventDefault(),$(".edit_multi_cod_contact").modal("show")}),$(".btn-modal_edit-multi-contact").on("click",function(t){t.preventDefault();var e=$("#base_url").val()+"common/action_edit_multi_cod_contact",a=[];$('input[type="checkbox"]').each(function(){$(this).is(":checked")&&a.push($(this).val())}),$.ajax({url:e,type:"POST",dataType:"json",data:$("#action_contact").serialize(),success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify(t.message,{position:"top left",className:"success",showDuration:200,autoHideDelay:5e3}),$.each(a,function(){$('tr[contact_id="'+this+'"]').remove()}),$(".edit_multi_cod_contact").modal("hide")):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}))},complete:function(){}})}),$(".send-email-to-viettel").confirm({theme:"supervan",title:"Bạn có chắc chắn muốn gửi email cho Viettel không?",content:'Hãy đảm bảo rằng các contact được chọn đang là trạng thái "đang giao hàng"!',buttons:{confirm:{text:"Gửi",action:function(){if(0==$("input.tbl-item-checkbox:checked").length)$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn contact cần gửi email!"});else if(1!=$('select[name="filter_provider_id"]').val())$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn đơn vị giao hàng là Viettel!"});else{var t=this.$target,e=t.data("form-id"),a=t.data("action"),n=t.data("method"),i=$("#base_url").val()+a;$("#"+e).attr("action",i).attr("method",n).submit()}}},cancel:{text:"Nope",action:function(){}},somethingElse:{text:"Khác",btnClass:"btn-blue",keys:["enter","shift"],action:function(){}}}}),$(document).on("click",".btn-edit-contact",function(t){if(t.preventDefault(),0==check_edit_contact())return!1;var e=$(this).parents(".form_edit_contact_modal").attr("action"),a=$(this).parents(".form_edit_contact_modal").attr("contact_id");$.ajax({url:e,type:"POST",dataType:"json",data:$(".form_edit_contact_modal").serialize(),beforeSend:function(){return $(".popup-wrapper").show()},success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify(t.message,{position:"top left",className:"success",showDuration:200,autoHideDelay:5e3}),$(".edit_contact_modal").modal("hide"),$('tr[contact_id="'+a+'"]').remove()):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}))},complete:function(){return $(".popup-wrapper").hide()}})}),$(document).on("change","select.edit_payment_method_rgt",function(t){2==$(this).val()?$(".tbl_bank").show(1e3):$(".tbl_bank").hide(),1==$(this).val()?$(".tbl_cod").show(1e3):$(".tbl_cod").hide(),setEqualTableHeight()}),$(document).on("change","select.note-cod-sample",function(){$('[name="note_cod"]').val($(this).val())}),$(function(){setTimeout(function(){$(".filter-tbl-1").height()>$(".filter-tbl-2").height()?$(".filter-tbl-2").height($(".filter-tbl-1").height()):$(".filter-tbl-1").height($(".filter-tbl-2").height())},300)}),$(document).on("click",".btn-send-account-lakita",function(t){if(t.preventDefault(),3!=$("select.cod_status_id").val())return $("#send_email_error")[0].play(),$.notify('Bạn cần chuyển trạng thái giao hàng là "Đã thu Lakita" trước khi thực hiện thao tác này!',{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}),!1;var e=$(this).attr("contact_id"),a=$("#base_url").val()+"send_email/send_account_lakita";$.ajax({url:a,type:"POST",data:{contact_id:e},dataType:"json",beforeSend:function(){return $(".popup-wrapper").show()},success:function(t){0==t.success?($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3})):($("#send_email_sound")[0].play(),$.notify("Gửi email thành công!",{position:"top left",className:"success",showDuration:200,autoHideDelay:3e3}))},complete:function(){return $(".popup-wrapper").hide()},error:function(){$("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra trong quá trình gửi email!",{position:"top left",className:"error",showDuration:200,autoHideDelay:3e3})}})}),$(document).on("click",".btn-send-banking-info",function(t){t.preventDefault();var e=$(this).attr("contact_id"),a=$("#base_url").val()+"send_email/send_banking_info";$.ajax({url:a,type:"POST",data:{contact_id:e,name:$(".edit-contact-name").val(),email:$(".edit-contact-email").val(),price_purchase:$(".edit-contact-price-purchase").val()},dataType:"json",beforeSend:function(){return $(".popup-wrapper").show()},success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify("Gửi email thành công!",{position:"top left",className:"success",showDuration:200,autoHideDelay:3e3})):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra. Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:3e3}))},complete:function(){return $(".popup-wrapper").hide()},error:function(){$("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra trong quá trình gửi email!",{position:"top left",className:"error",showDuration:200,autoHideDelay:3e3})}})}),$(document).on("click",".send-banking-info-multi-course",function(t){t.preventDefault();var e=$("#base_url").val()+"send_email/send_banking_info";if(0==$("input.tbl-item-checkbox:checked").length)$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn contact cần gửi email!"});else{var a=$("input.tbl-item-checkbox:checked").length,n=0;for(i=0;i<a;i++)n+=parseInt($($("input.tbl-item-checkbox:checked")[i]).parent().parent().find(".tbl_price_purchase").text());n*=1e3;var c=[],o="";$("input.tbl-item-checkbox:checked").each(function(){var t=$(this).parent().parent().find(".show-more-table-info").attr("contact-id");o=$(this).parent().parent().find(".tbl_name").text(),c.push($.trim($("#"+t).find(".extra-view-contact-email").text()))}),o=$.trim(o),o=o.substring(0,o.length-1);var l=c.unique();l.length>1?$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Các contact đã chọn không có cùng địa chỉ email. \n                Bạn cần sửa lại email để đảm bảo cùng là 1 người!"}):1==l.length&&""==l[0]?$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Email rỗng. Vui lòng kiểm tra lại!"}):$.confirm({theme:"supervan",title:"Kiểm tra thông tin gửi email",content:"Họ tên: "+o+", email: "+l[0]+", số tiền: "+n.toLocaleString()+". Combo "+a+" khóa học",buttons:{confirm:{text:"Look good!",action:function(){$.ajax({url:e,type:"POST",dataType:"json",data:{name:o,email:l[0],price_purchase:n,number_of_course:a},beforeSend:function(){return $(".popup-wrapper").show()},success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify(t.message,{position:"top left",className:"success",showDuration:200,autoHideDelay:5e3})):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}))},complete:function(){return $(".popup-wrapper").hide()},error:function(){$("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra trong quá trình gửi email!",{position:"top left",className:"error",showDuration:200,autoHideDelay:3e3})}})}},cancel:{text:"Cancel",action:function(){}},somethingElse:{text:"Khác",btnClass:"btn-blue",keys:["enter","shift"],action:function(){}}}})}}),$(".view_contact_star_modal").on("hide.bs.modal",function(){return setTimeout(function(){return $("div.replace_content_view_contact_star").html("")},1e3)}),$(document).on("contextmenu","tr.custom_right_menu",function(t){t.preventDefault();var e=$(this).attr("contact_id"),a=$(this).attr("contact_name"),n=$(this).attr("duplicate_id"),i=$(this).attr("contact_phone"),c=$("#input_controller").val();right_context_menu_display(c,e,a,n,i);var o=$(this).attr("item_id");$(".delete_item, .edit_item").attr("item_id",o);var l=$(".menu");l.hide();var r=t.pageX,s=t.pageY;l.css({top:s,left:r});var d=l.width(),u=l.height(),m=$(window).width(),h=$(window).height(),p=$(window).scrollTop();r+d>m&&l.css({left:r-d}),s+u>h+p&&l.css({top:s-u}),l.show(),$(this).find('input[type="checkbox"]')[0].checked?unselect_not_checked():($(".checked").removeClass("checked"),uncheck_checked()),$(this).addClass("checked")}),$(document).on("click","td.tbl_name, td.tbl_address",function(){$(this).parent().hasClass("checked")?$(this).parent().removeClass("checked"):$(this).parent().addClass("checked");var t=$(this).parent().find(".tbl-item-checkbox");t.is(":checked")?t.prop("checked",!1):t.prop("checked",!0),unselect_not_checked(),show_number_selected_row()}),$("html").on("click",function(t){$(".menu").hide(),$(".menu-item").hide(),-1===t.target.className.indexOf("form-inline")&&-1===t.target.className.indexOf("number_paging")||($("input.tbl-item-checkbox").prop("checked",!1),$(".checked").removeClass("checked"))}),shortcut.add("Ctrl+s",function(){$(".btn-edit-contact").click()}),shortcut.add("Ctrl+Shift+a",function(){$("input.tbl-item-checkbox").prop("checked",!0),$(".custom_right_menu").addClass("checked"),show_number_selected_row()}),shortcut.add("Esc",function(){$("input.tbl-item-checkbox").prop("checked",!1),$(".checked").removeClass("checked"),$(".menu").hide()});var checked=!0;$(document).on("click",".check_all",function(){(checked=!checked)?$(".list_contact input.tbl-item-checkbox").each(function(){$(this).prop("checked",!1),$(this).parent().parent().removeClass("checked")}):($(".list_contact input.tbl-item-checkbox").each(function(){$(this).prop("checked",!0),$(this).parent().parent().addClass("checked")}),show_number_selected_row())}),$(document).on("click",".find-course-code",function(){var t=$(this);$.ajax({url:$("#base_url").val()+"public/json/course.json",type:"GET",dataType:"json",success:function(e){var a=0;$.each(e.course,function(e,n){n.course_code==t.text().trim()&&(t.notify(n.name_course,{position:"top center",className:"success",showDuration:200,autoHideDelay:4e3}),a=1)}),a||t.notify("KHÔNG TÌM THẤY MÃ KHÓA HỌC NÀY",{position:"top center",className:"success",showDuration:200,autoHideDelay:4e3})}})}),$(".datepicker").datepicker({dateFormat:"dd-mm-yy"});var d=new Date,currDate=d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear(),pastDate=d.getDate()+"-"+d.getMonth()+"-"+d.getFullYear();$(".daterangepicker").daterangepicker({autoApply:!0,autoUpdateInput:!1,locale:{format:"DD/MM/YYYY",cancelLabel:"Clear"},ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract(1,"days"),moment().subtract(1,"days")],"7 ngày vừa qua":[moment().subtract(6,"days"),moment()],"30 ngày vừa qua":[moment().subtract(29,"days"),moment()],"Tuần này":[moment().startOf("isoWeek"),moment().endOf("isoWeek")],"Tuần trước":[moment().subtract(1,"weeks").startOf("isoWeek"),moment().subtract(1,"weeks").endOf("isoWeek")],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:pastDate,endDate:currDate}).on({"apply.daterangepicker":function(t,e){$(this).val(e.startDate.format("DD/MM/YYYY")+" - "+e.endDate.format("DD/MM/YYYY"))},"cancel.daterangepicker":function(t,e){$(this).val("")}}),$(".reset_datepicker").click(function(t){t.preventDefault(),$("#datepicker").val("")}),$(function(){new Clipboard(".btn-copy").on("success",function(){$.notify("Copy thành công vào clipboard",{position:"top left",className:"success",showDuration:200,autoHideDelay:2e3})})}),$(document).on("click",".view_contact_phone",function(){document.getElementById("input-copy").select(),document.execCommand("copy"),$.notify("Copy thành công vào clipboard",{position:"top left",className:"success",showDuration:200,autoHideDelay:2e3})}),Dropzone.options.dropzoneFileUpload={dictDefaultMessage:"Thả file vào đây hoặc click vào đây để upload",acceptedFiles:".xls, .xlsx",maxFilesize:10,init:function(){this.on("addedfile",function(){$(".popup-wrapper").show()}).on("success",function(){location.href=$("#redirect-dropzone").val()}).on("error",function(){$(".popup-wrapper").hide()})}},$(document).ready(function(){$("input.filter_contact").click(function(t){t.preventDefault(),$("#action_contact").attr("action","#").attr("method","GET"),$("#action_contact").submit()}),$("input.reset_form").click(function(t){t.preventDefault(),$("option[value=0]").attr("selected","selected"),$('option[value="empty"]').attr("selected","selected"),$(".datepicker").val(""),$("input[type='text']").val(""),$(".selectpicker").selectpicker("deselectAll")}),$("select.filter").on("change",function(t){t.preventDefault(),$("#action_contact").attr("action","#").attr("method","GET"),$("#action_contact").submit()}),$('th[class^="order_"]').click(function(){var t=$(this).attr("class");t=(t=t.split(/ /))[0],$('input[class^="order_"]').not("input."+t).attr("value","0"),"0"!==$("input."+t).val()?"ASC"!==$("input."+t).val()?"DESC"!==$("input."+t).val()||$("input."+t).val("0").promise().done(function(){$("#action_contact").attr("action","#").attr("method","GET"),$("#action_contact").submit()}):$("input."+t).val("DESC").promise().done(function(){$("#action_contact").attr("action","#").attr("method","GET"),$("#action_contact").submit()}):$("input."+t).attr("value","ASC").promise().done(function(){$("#action_contact").attr("action","#").attr("method","GET"),$("#action_contact").submit()})})}),$(function(){$(".dropdown-hover").hover(function(){$(this).find(".dropdown-menu").stop(!0,!0).fadeIn(200),$(this).find(".child_menu").stop(!0,!0).fadeIn(200)},function(){$(this).find(".dropdown-menu").stop(!0,!0).fadeOut(200),$(this).find(".child_menu").stop(!0,!0).fadeOut(200)}),$("#curr_url").val(location.href),$(document).on("click",".show-more-table-info",function(t){t.stopPropagation();var e=$(this).attr("contact-id");$("#"+e).toggle("slow"),"1"==$(this).attr("is-hide")?($(this).attr("is-hide","0"),$(this).html('<i class="fa fa-minus-circle" aria-hidden="true"></i>')):($(this).attr("is-hide","1"),$(this).html('<i class="fa fa-plus-circle" aria-hidden="true"></i>'))}),$("#collapse-filter").on("shown.bs.collapse",function(){$(this).prev().find(".fa").removeClass("fa-arrow-circle-down").addClass("fa-arrow-circle-up"),$(".filter-tbl-1").height()>$(".filter-tbl-2").height()?$(".filter-tbl-2").height($(".filter-tbl-1").height()):$(".filter-tbl-1").height($(".filter-tbl-2").height())}),$("#collapse-filter").on("hidden.bs.collapse",function(){$(this).prev().find(".fa").removeClass("fa-arrow-circle-up").addClass("fa-arrow-circle-down")})}),$(".send_to_mobile").on("click",function(t){t.preventDefault();var e=$(this).attr("contact_phone"),a=$(this).attr("contact_name");$.ajax({url:$("#base_url").val()+"common/send_phone_to_mobile",type:"post",data:{contact_phone:e,contact_name:a},success:function(){$.notify("Gửi thành công đến mobile!",{position:"top left",className:"success",showDuration:200,autoHideDelay:3e3})}})}),Pusher.logToConsole=!0;var pusher=new Pusher("e37045ff133e03de137a",{cluster:"ap1",encrypted:!0}),channel=pusher.subscribe("my-channel");channel.bind("notice",function(t){$("#notificate")[0].play(),n=new Notification(t.title,{body:t.message,icon:$("#base_url").val()+"public/images/logo2.png",tag:"https://crm2.lakita.vn/quan-ly/trang-chu.html",sound:$("#base_url").val()+"public/mp3/new-contact.mp3",image:t.image});var e=' <div style="position: fixed; right:10px; bottom: 10px; z-index: 999999999; \n         background-color: #fff; display: inline-block; width: 30%; border-radius: 5px" id="my-notify">\n        <div style="float:left; width: 35%; padding: 2%">\n            <img src="https://crm2.lakita.vn/public/images/logo2.png" style="width: 70%"/>\n        </div>\n        <div style="float:left; width:65%; padding: 2%">\n            <h4> '+t.title+" </h4>\n            <p> "+t.message+' </p>\n            <div>\n                <img src="'+t.image+'" style="width: 90%"/>\n            </div>\n        </div>\n    </div>';$("body").append(e),setTimeout(function(){$("#my-notify").remove()},1e4),("manager"===$("#input_controller").val()&&"index"===$("#input_method").val()||"marketing"===$("#input_controller").val()&&"index"===$("#input_method").val())&&setTimeout(function(){location.reload()},4e3)}),channel.bind("callLog",function(t){n=new Notification(t.title,{body:t.message,icon:$("#base_url").val()+"public/images/logo2.png",tag:"https://crm2.lakita.vn/quan-ly/trang-chu.html",image:t.image});var e=' <div style="position: fixed; right:10px; bottom: 10px; z-index: 999999999; \n         background-color: #fff; display: inline-block; width: 30%; border-radius: 5px" id="my-notify">\n        <div style="float:left; width: 35%; padding: 2%">\n            <img src="https://crm2.lakita.vn/public/images/logo2.png" style="width: 70%"/>\n        </div>\n        <div style="float:left; width:65%; padding: 2%">\n            <h4> '+t.title+" </h4>\n            <p> "+t.message+' </p>\n            <div>\n                <img src="'+t.image+'" style="width: 90%"/>\n            </div>\n        </div>\n    </div>';$("body").append(e),setTimeout(function(){$("#my-notify").remove()},1e4),"1"==t.success?$("#call-log-L6-sound")[0].play():$("#call-log-sound")[0].play()}),$("li.mega-dropdown").mouseover(function(){return $(".black-over").css("bottom","0%")}).mouseout(function(){return $(".black-over").css("bottom","100%")}),$(document).on("hide.bs.modal",".navbar-search-modal",function(){$(".navbar-search-modal").remove()}),$(document).on("hide.bs.modal",".view-all-contact-courses-modal",function(){$(".view-all-contact-courses-modal").remove()}),$(document).on("hide.bs.modal",".modal",function(){-1!=$(this).find(".modal-dialog").attr("class").search("btn-very-lg")?$(this).find(".modal-dialog").attr("class","modal-dialog fadeOut animated btn-very-lg"):-1!=$(this).find(".modal-dialog").attr("class").search("modal-lg")?$(this).find(".modal-dialog").attr("class","modal-dialog fadeOut animated modal-lg"):$(this).find(".modal-dialog").attr("class","modal-dialog fadeOut animated")}),$(document).on("show.bs.modal",".modal",function(){$(".selectpicker").selectpicker({}),$(".datepicker").datepicker({dateFormat:"dd-mm-yy"}),$(".reset_datepicker").click(function(t){t.preventDefault(),$(".datepicker").val(""),$(".datetimepicker").val("")}),$(".datetimepicker").datetimepicker({format:"DD-MM-YYYY HH:mm"}),2!=$("select.edit_payment_method_rgt").val()&&$(".tbl_bank").hide(),1!=$("select.edit_payment_method_rgt").val()&&$(".tbl_cod").hide(),setTimeout(function(){setEqualTableHeight()},1e3),-1!=$(this).find(".modal-dialog").attr("class").search("btn-very-lg")?$(this).find(".modal-dialog").attr("class","modal-dialog fadeIn animated btn-very-lg"):-1!=$(this).find(".modal-dialog").attr("class").search("modal-lg")?$(this).find(".modal-dialog").attr("class","modal-dialog fadeIn animated modal-lg"):$(this).find(".modal-dialog").attr("class","modal-dialog fadeIn animated");var t=1040+10*$(".modal:visible").length;$(this).css("z-index",t),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",t-1).addClass("modal-stack")},0)}),$(document).on("click",".ajax-request-modal",function(t){t.stopPropagation(),t.preventDefault();var e=$(this);setTimeout(function(){$(".checked").removeClass("checked"),e.parent().parent().addClass("checked");var t=e.attr("data-contact-id"),a=$("#base_url").val()+e.attr("data-url"),n=e.attr("data-modal-name"),i=e.attr("data-controller");$.ajax({url:a,type:"POST",dataType:"json",data:{contact_id:t,controller:i},success:function(t){if(0==t.success)return $("#send_email_error")[0].play(),$.notify(t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}),!1;$("."+n).remove();var e='<div class="'+n+'"></div>';$(".modal-append-to").append(e),$("."+n).html(t.message)},complete:function(){return $("."+n+" .modal").modal("show")}})},100)}),$(document).on("click",".change-form-submit-url",function(t){t.preventDefault();var e=$(this).data("form-id"),a=$(this).data("action"),n=$(this).data("method"),i=$("#base_url").val()+a;$("#"+e).attr("action",i).attr("method",n).submit()});var modalName="navbar-search-modal";$(function(){var t=location.hash;if(t.indexOf("search")>-1){var e=t.substring(1).split("=")[1];$(".input-navbar-search").val(e),$.ajax({url:$("#base_url").val()+$("#input_controller").val()+"/search",type:"GET",data:{search_all:e},success:function(t){$("."+modalName).remove();var e='<div class="'+modalName+'"></div>';$("#action_contact").length?$("#action_contact").append(e):$(".modal-append-to").append(e),$("."+modalName).html(t)},complete:function(){return $("."+modalName+" .navbar-search-modal").modal("show")}})}}),$(".btn-navbar-search").click(function(t){if(t.preventDefault(),""==$(".input-navbar-search").val())return $("#send_email_error")[0].play(),$.notify("Vui lòng nhập nội dung tìm kiếm!",{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}),!1;var e=location.href.split("#");location.href=e[0]+"#search="+$(".input-navbar-search").val(),$.ajax({url:$("#base_url").val()+$("#input_controller").val()+"/search",type:"GET",data:{search_all:$(".input-navbar-search").val()},success:function(t){$("."+modalName).remove();var e='<div class="'+modalName+'"></div>';$("#action_contact").length?$("#action_contact").append(e):$(".modal-append-to").append(e),$("."+modalName).html(t)},complete:function(){return $("."+modalName+" .navbar-search-modal").modal("show")}})}),$(".anchor-navbar-search").click(function(t){t.preventDefault(),$.ajax({url:$("#base_url").val()+$("#input_controller").val()+"/search",type:"GET",data:{search_all:$.trim($(this).text())},success:function(t){$("."+modalName).remove();var e='<div class="'+modalName+'"></div>';$("#action_contact").length?$("#action_contact").append(e):$(".modal-append-to").append(e),$("."+modalName).html(t)},complete:function(){return $("."+modalName+" .navbar-search-modal").modal("show")}})}),$(document).on("click",".export-to-excel",function(t){if(t.preventDefault(),0==$("input.tbl-item-checkbox:checked").length)$.alert({theme:"modern",type:"red",title:"Có lỗi xảy ra!",content:"Vui lòng chọn contact cần xuất ra file excel!"});else{$(".popup-wrapper").show(),setTimeout(function(){$(".popup-wrapper").hide()},3e3);var e=$(this).data("form-id"),a=$(this).data("action"),n=$(this).data("method"),i=$("#base_url").val()+a;$("#"+e).attr("action",i).attr("method",n).submit()}}),$("a.cancel_one_contact").on("click",function(t){var e=$(this),a=$(this).attr("sale_id"),n=$(".total_contact_sale_"+a).text();t.preventDefault(),$.ajax({type:"POST",url:$("#base_url").val()+"manager/cancel_one_contact",data:{contact_id:$(this).attr("contact_id")},beforeSend:function(){},success:function(t){"1"===t?(e.parent().parent().hide(),$(".total_contact_sale_"+a).text(n-1)):alert(t)},error:function(t){alert(t)},complete:function(){}})}),$(".cancel_multi_contact").on("click",function(t){$("#action_contact").attr("action",$("#base_url").val()+"manager/cancel_multi_contact"),$("#action_contact").submit()}),$("#delete_contact").on("click",function(t){t.preventDefault(),!0===confirm("Are you sure?")&&($("#action_contact").attr("action",$("#base_url").val()+"manager/delete_contact"),$("#action_contact").submit())}),$(document).on("click","a.delete_one_contact",function(t){$(this);var e=$(this).attr("contact_id");t.preventDefault(),$.ajax({type:"POST",url:$("#base_url").val()+"manager/delete_one_contact",data:{contact_id:e},success:function(t){"1"===t?$(".duplicate_"+e).hide():alert(t)},error:function(){alert(errorThrown)}})}),$("a.divide_contact").on("click",function(t){t.preventDefault(),$("#action_contact").removeClass("form-inline"),$(".divide_multi_contact_modal").modal("show")}),$(document).on("click",".divide_one_contact_achor",function(t){t.preventDefault(),$("#action_contact").removeClass("form-inline");var e=$(this).attr("contact_id");$(".checked").removeClass("checked"),$(this).parent().parent().addClass("checked"),$("#contact_id_input").val(e);var a=$(this).attr("contact_name");$("span.contact_name").text(a),$(".divide_one_contact_modal").modal("show")}),$(".divide_contact_even").on("click",function(t){t.preventDefault(),$("#action_contact").attr("action",$("#base_url").val()+"manager/divide_contact_even"),$("#action_contact").submit()}),$(document).on("click",".btn-divide-one-contact",function(t){t.preventDefault();var e=$(this).parents("#divide_one_contact").attr("action"),a=$("#contact_id_input").val();$.ajax({url:e,type:"POST",dataType:"json",data:$("#divide_one_contact").serialize(),success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify(t.message,{position:"top left",className:"success",showDuration:200,autoHideDelay:5e3}),$(".divide_one_contact_modal").modal("hide"),$('tr[contact_id="'+a+'"]').remove()):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}))}})}),$(document).on("click",".btn-divide-multi-contact",function(t){t.preventDefault();var e=$("#base_url").val()+"manager/divide_contact",a=[];$('input[type="checkbox"]').each(function(){$(this).is(":checked")&&a.push($(this).val())}),$.ajax({url:e,type:"POST",dataType:"json",data:$("#action_contact").serialize(),success:function(t){1==t.success?($("#send_email_sound")[0].play(),$.notify(t.message,{position:"top left",className:"success",showDuration:200,autoHideDelay:5e3}),$(".divide_multi_contact_modal").modal("hide"),$.each(a,function(){$('tr[contact_id="'+this+'"]').remove()})):($("#send_email_error")[0].play(),$.notify("Có lỗi xảy ra! Nội dung: "+t.message,{position:"top left",className:"error",showDuration:200,autoHideDelay:7e3}))}})}),$("input.reset_form").on("click",function(t){t.preventDefault(),$("option[value=0]").attr("selected","selected"),$('option[value="empty"]').attr("selected","selected"),$(".datepicker").val(""),$("input[type='text']").val(""),$(".selectpicker").selectpicker("deselectAll")}),$(document).on("click",".btn-edit-contact",function(t){$("#input_controller").val()}),$(document).on("change","select.select_script",function(){var t=$("#base_url").val()+"sale/show_script_modal";0!=$(this).val()&&$.ajax({url:t,type:"POST",data:{script_id:$(this).val()},success:function(t){return $("div.replace_content_script").html(t)},complete:function(){return $(".script_modal").modal("show")}})}),$(document).on("click","a.transfer_contact, a.transfer_one_contact",function(t){if(t.preventDefault(),"transfer_contact"==$(this).attr("class").split(" ")[0])$("#action_contact").removeClass("form-inline"),$(".transfer_multi_contact_modal").modal("show");else{$(".checked").removeClass("checked"),$(this).parent().parent().addClass("checked");var e=$(this).attr("contact_id"),a=$(this).attr("contact_name");$("#contact_id_input").val(e),$(".contact_name_replacement").text(a),$(".transfer_one_contact_modal").modal("show")}}),$(document).on("change",'[name="add_channel_id"], [name="edit_channel_id"]',function(){var t=$(this).val();$.ajax({url:$("#base_url").val()+"MANAGERS/link/get_campaign",type:"POST",data:{channel_id:t},success:function(t){$(".ajax_campaign").html(t),$(".ajax_adset").html(""),$(".ajax_ad").html("")},complete:function(){$(".selectpicker").selectpicker({})}})}),$(document).on("change",'[name="add_campaign_id"]',function(){var t=$(this).val();$.ajax({url:$("#base_url").val()+"MANAGERS/link/get_adset",type:"POST",data:{campagin_id:t},success:function(t){$(".ajax_adset").html(t),$(".ajax_ad").html("")},complete:function(){$(".selectpicker").selectpicker({})}})}),$(document).on("change",'[name="add_adset_id"]',function(){var t=$(this).val();$.ajax({url:$("#base_url").val()+"MANAGERS/link/get_ad",type:"POST",data:{adset_id:t},success:function(t){$(".ajax_ad").html(t)},complete:function(){$(".selectpicker").selectpicker({})}})}),$(document).on("change",'[name="add_landingpage_id"]',function(){var t='<iframe width="100%" height="500px" src="'+$(this).find(":selected").data("url")+'"></iframe>';$(".modal-replace-preview-landingpage").html(t),$(".modal-preview-landingpage").modal("show")});